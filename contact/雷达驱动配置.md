# é›·è¾¾é©±åŠ¨é…ç½®

ğŸ“¢ Livox mid360æ‰€ä½¿ç”¨çš„é©±åŠ¨ä¸ºLivox-SDK2å’Œlivox_ros_driver2è‹¥ä½¿ç”¨Point-lioåˆ™æ— éœ€é…ç½®SDK1å’Œdriver1ï¼Œè‹¥æŒ‰â€œä»£ç éƒ¨ç½²â€ç« èŠ‚èµ°äº†ä¸€éåˆ™æ— éœ€å†æ¬¡å®‰è£…é©±åŠ¨ï¼Œè·³è‡³â€œé…ç½®â€éƒ¨åˆ†å³å¯

## å®‰è£…Livox-SDK2

1. Install theÂ CMakeÂ using aptï¼ˆå®‰è£…CMakeï¼‰:

```shell
sudo apt install cmake
```

1. Compile and install the Livox-SDK2ï¼ˆç¼–è¯‘å®‰è£…Livox-SDK2ï¼‰:

```shell
git clone https://github.com/Livox-SDK/Livox-SDK2.git
cd ./Livox-SDK2/
mkdir build
cd build
cmake .. && make -j
sudo make install
```

SDKäºROSå·¥ä½œç©ºé—´å¤–ç¼–è¯‘å®‰è£…å³å¯ï¼Œä¼šä½œä¸ºdriverçš„åº“æ–‡ä»¶æ¥ä½¿ç”¨

## å®‰è£…livox_ros_driver2

æ‰“å¼€ä½ çš„ROSå·¥ä½œç©ºé—´ï¼Œå¦‚gitåº“ä¸­å…‹éš†çš„sentry_ros_3dçš„ä»£ç åº“ä¹Ÿæ˜¯å·¥ä½œç©ºé—´ï¼Œæ‰“å¼€å…¶ä¸­çš„srcæ–‡ä»¶å¤¹

```shell
cd sentry_ros_3d
cd src
```

è¾“å…¥git cloneæŒ‡ä»¤ä¸‹è½½livox_ros_driver2çš„ä»£ç 

```shell
git clone https://github.com/Livox-SDK/livox_ros_driver2.git
```

ç›´æ¥catkin_makeå•ç‹¬çš„é©±åŠ¨åŒ…å³å¯

```shell
catkin_make -DCATKIN_WHITELIST_PACKAGES="livox_ros_driver2"
```

## é›·è¾¾é…ç½®

### å¤–å‚é…ç½®

é›·è¾¾çš„ç‚¹äº‘å¤–å‚çŸ«æ­£å¯ä»¥ä½¿ç”¨livox_viewer2çš„å¤–å‚æ ‡å®šå·¥å…·å¯è§†åŒ–æ ‡å®šå¤–å‚ï¼Œè°ƒé«˜ç‚¹äº‘ç§¯åˆ†æ—¶é—´ä¸º3000msç„¶åè°ƒæ•´è§’åº¦ä½¿ç‚¹äº‘æ˜¯æ­£çš„ï¼Œè®°å½•ä¸‹å‚æ•°ï¼Œå¡«å…¥configä¸­

### launchæ–‡ä»¶é…ç½®

ä¸€èˆ¬ä½¿ç”¨é©±åŠ¨æ˜¯ä½¿ç”¨msg_MID360.launchç„¶åå†ç”¨è‡ªå®šä¹‰æ¶ˆæ¯è½¬Pointcloudçš„ç¨‹åºå†æ¬¡è½¬å‘å‡ºå»ï¼Œå› ä¸ºFast-lioå’ŒPoint-lioéƒ½æ˜¯ä½¿ç”¨livoxçš„è‡ªå®šä¹‰æ¶ˆæ¯

å› ä¸ºmid360æ˜¯åŠå›ºæ€é›·è¾¾ï¼Œå…¶ç‚¹äº‘å¯†åº¦åŸºäºå…¶ç‚¹äº‘ç§¯åˆ†æ—¶é—´ï¼Œè°ƒä½ç‚¹äº‘å‘å¸ƒé¢‘ç‡å¯ä»¥å¾—åˆ°æ›´ç¨ å¯†çš„ç‚¹äº‘æé«˜æ¿€å…‰é‡Œç¨‹è®¡ç²¾åº¦ä½†æ˜¯å…¶è¿åŠ¨ç•¸å˜ï¼ˆï¼Ÿåº”è¯¥æ˜¯ï¼‰è¾ƒå¤§ï¼Œä¸”ç‚¹äº‘æ›´æ–°ä¼šæœ‰è¾ƒå¤§å»¶è¿Ÿï¼Œè°ƒé«˜ç‚¹äº‘å‘å¸ƒé¢‘ç‡å¯ä»¥æé«˜Point-lioæ‰“å¼€é™é‡‡æ ·æ—¶çš„é‡Œç¨‹è®¡é¢‘ç‡ï¼ˆç‚¹äº‘20hzâ†’æ¿€å…‰é‡Œç¨‹è®¡å°±20hzï¼‰ï¼Œä½†ç‚¹äº‘å¯†åº¦ä¼šè¾ƒç–ï¼Œé™ä½é‡Œç¨‹è®¡ç²¾åº¦ï¼ˆå…¶å®å®é™…ä¸Šä¹Ÿæ²¡å‡é™å¤šå°‘ï¼Œæ„ŸçŸ¥ä¸å¼ºï¼‰

### configæ–‡ä»¶é…ç½®

```js
{
  "lidar_summary_info" : {
    "lidar_type": 8
  },
  "MID360": {
    "lidar_net_info" : {
      "cmd_data_port": 56100,
      "push_msg_port": 56200,
      "point_data_port": 56300,
      "imu_data_port": 56400,
      "log_data_port": 56500
    },
    "host_net_info" : {
      "cmd_data_ip" : "192.168.1.50",#ä¸»æœºIPï¼Œä¸€èˆ¬æŒ‰æ‰‹å†Œè®¾ç½®ç”µè„‘è¿æ¥é›·è¾¾çš„ç½‘å£ä¸ºé™æ€IPä¸”IPä¸º"192.168.1.50"
      "cmd_data_port": 56101,
      "push_msg_ip": "192.168.1.50",
      "push_msg_port": 56201,
      "point_data_ip": "192.168.1.50",
      "point_data_port": 56301,
      "imu_data_ip" : "192.168.1.50",
      "imu_data_port": 56401,
      "log_data_ip" : "",
      "log_data_port": 56501
    }
  },

  "lidar_configs" : [
    {
      "ip" : "192.168.1.3",#é›·è¾¾çš„ip
      "pcl_data_type" : 1,
      "pattern_mode" : 0,
      "extrinsic_parameter" : { #é›·è¾¾çš„å¤–å‚ï¼Œå•ä½ä¸ºåº¦ã€å˜ç±³
        "roll": -37.0,
        "pitch": 0.0,
        "yaw": -90.0,
        "x": 0,
        "y": -23,
        "z": 55
      }
    },
    {#åŒé›·è¾¾æ—¶å¢åŠ æ­¤æ®µï¼Œç„¶åå¡«ä¸Šç¬¬äºŒä¸ªé›·è¾¾çš„ipï¼Œå¤–å‚
      "ip" : "192.168.1.140",
      "pcl_data_type" : 1,
      "pattern_mode" : 0,
      "extrinsic_parameter" : {
        "roll": 180.0,
        "pitch": 0.0,
        "yaw": 0.0,
        "x": 0,
        "y": 0,
        "z": 45.0
      }
    }
  ]
}
```

## ä½¿ç”¨livox_repubåŠŸèƒ½åŒ…è½¬å‘livoxè‡ªå®šä¹‰æ¶ˆæ¯ä¸­çš„ç‚¹äº‘è¯é¢˜

gitåº“ä»£ç ä¸­å·²æœ‰æ­¤åŠŸèƒ½åŒ…ï¼Œç¼–è¯‘ä½¿ç”¨å³å¯ï¼Œè‹¥éœ€ä¿®æ”¹ä¼ è¿›å»çš„livoxè‡ªå®šä¹‰æ¶ˆæ¯è¯é¢˜ï¼Œä¿®æ”¹livox_repubåŠŸèƒ½åŒ…ä¸­çš„livox_repub.launchæ–‡ä»¶ä¸­çš„<remap to/>çš„è¯é¢˜å³å¯ï¼Œè‹¥éœ€ä¿®æ”¹è½¬å‘å‡ºæ¥çš„ç‚¹äº‘è¯é¢˜åˆ™éœ€ä¿®æ”¹livox_repub.cppçš„æºç ä¸­å‘å¸ƒçš„è¯é¢˜åï¼ˆé»˜è®¤ä¸º"livox_pcl0"ï¼‰

```cpp
pub_pcl_out1 = nh.advertise("/livox_pcl0", 100);
```
